\hypertarget{a00014}{}\subsection{T\+WI Library $<$twi.\+h$>$}
\label{a00014}\index{T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}}


T\+WI library for A\+V\+R-\/\+G\+CC.  


\subsubsection*{Definition of frequencies}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{a00014_ga43bafb28b29491ec7f871319b5a3b2f8}{F\+\_\+\+C\+PU}~16000000\hypertarget{a00014_ga43bafb28b29491ec7f871319b5a3b2f8}{}\label{a00014_ga43bafb28b29491ec7f871319b5a3b2f8}

\begin{DoxyCompactList}\small\item\em C\+PU frequency in Hz required for delay. \end{DoxyCompactList}\item 
\#define \hyperlink{a00014_ga7a1c522bed64982971384489ee477bd3}{F\+\_\+\+S\+CL}~50000\hypertarget{a00014_ga7a1c522bed64982971384489ee477bd3}{}\label{a00014_ga7a1c522bed64982971384489ee477bd3}

\begin{DoxyCompactList}\small\item\em T\+WI bit rate. Must be greater than 31000. \end{DoxyCompactList}\item 
\#define \hyperlink{a00014_ga801c158406ca2334b446e442a2debe37}{T\+W\+I\+\_\+\+B\+I\+T\+\_\+\+R\+A\+T\+E\+\_\+\+R\+EG}~((\hyperlink{a00014_ga43bafb28b29491ec7f871319b5a3b2f8}{F\+\_\+\+C\+PU}/\hyperlink{a00014_ga7a1c522bed64982971384489ee477bd3}{F\+\_\+\+S\+CL} -\/ 16) / 2)\hypertarget{a00014_ga801c158406ca2334b446e442a2debe37}{}\label{a00014_ga801c158406ca2334b446e442a2debe37}

\begin{DoxyCompactList}\small\item\em T\+WI bit rate register value. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Definition of ports and pins}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{a00014_ga762c164f4acd04d3ce3627fe73e7c018}{T\+W\+I\+\_\+\+P\+O\+RT}~P\+O\+R\+TC\hypertarget{a00014_ga762c164f4acd04d3ce3627fe73e7c018}{}\label{a00014_ga762c164f4acd04d3ce3627fe73e7c018}

\begin{DoxyCompactList}\small\item\em Port of T\+WI hardware unit. \end{DoxyCompactList}\item 
\#define \hyperlink{a00014_ga3f14ed8491293d0dda1372cceaa39851}{T\+W\+I\+\_\+\+S\+D\+A\+\_\+\+P\+IN}~4\hypertarget{a00014_ga3f14ed8491293d0dda1372cceaa39851}{}\label{a00014_ga3f14ed8491293d0dda1372cceaa39851}

\begin{DoxyCompactList}\small\item\em S\+DA pin of T\+WI hardware unit. \end{DoxyCompactList}\item 
\#define \hyperlink{a00014_gac0ad8b33f1be48e211f1eeae2dd65cee}{T\+W\+I\+\_\+\+S\+C\+L\+\_\+\+P\+IN}~5\hypertarget{a00014_gac0ad8b33f1be48e211f1eeae2dd65cee}{}\label{a00014_gac0ad8b33f1be48e211f1eeae2dd65cee}

\begin{DoxyCompactList}\small\item\em S\+CL pin of T\+WI hardware unit. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Other definitions}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{a00014_gaaf9a8abccd811954f9cc316f2b2f87b3}{T\+W\+I\+\_\+\+R\+E\+AD}~1\hypertarget{a00014_gaaf9a8abccd811954f9cc316f2b2f87b3}{}\label{a00014_gaaf9a8abccd811954f9cc316f2b2f87b3}

\begin{DoxyCompactList}\small\item\em Data direction for reading from T\+WI device. \end{DoxyCompactList}\item 
\#define \hyperlink{a00014_ga3b68e8e777b71520f9dbfac733774d5f}{T\+W\+I\+\_\+\+W\+R\+I\+TE}~0\hypertarget{a00014_ga3b68e8e777b71520f9dbfac733774d5f}{}\label{a00014_ga3b68e8e777b71520f9dbfac733774d5f}

\begin{DoxyCompactList}\small\item\em Data direction for writing to T\+WI device. \end{DoxyCompactList}\item 
\#define \hyperlink{a00014_ga6c0346728feb274834cad94daca316ee}{D\+DR}(\+\_\+x)~($\ast$(\&\+\_\+x -\/ 1))\hypertarget{a00014_ga6c0346728feb274834cad94daca316ee}{}\label{a00014_ga6c0346728feb274834cad94daca316ee}

\begin{DoxyCompactList}\small\item\em Define address of Data Direction Register of port \+\_\+x. \end{DoxyCompactList}\item 
\#define \hyperlink{a00014_ga740f9eb9c9f9e33500ee61ec53945f6a}{P\+IN}(\+\_\+x)~($\ast$(\&\+\_\+x -\/ 2))\hypertarget{a00014_ga740f9eb9c9f9e33500ee61ec53945f6a}{}\label{a00014_ga740f9eb9c9f9e33500ee61ec53945f6a}

\begin{DoxyCompactList}\small\item\em Define address of input register of port \+\_\+x. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{a00014_ga16f0e6b2fa5a26eadbf4086ab6d54467}{twi\+\_\+init} (void)
\begin{DoxyCompactList}\small\item\em Initialize T\+WI, enable internal pull-\/ups, set S\+CL frequency. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{a00014_ga36b3c950a1804f75057a870afdf81d55}{twi\+\_\+start} (uint8\+\_\+t slave\+\_\+address)
\begin{DoxyCompactList}\small\item\em Start communication on T\+WI bus and send address of T\+WI slave. \end{DoxyCompactList}\item 
void \hyperlink{a00014_gab45679e1a7b3b8f97b636d825e7d14f7}{twi\+\_\+write} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em Send one data byte to T\+WI slave device. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{a00014_ga7a2cd23dea30ee2c99c1ccffb3402d79}{twi\+\_\+read\+\_\+ack} (void)
\begin{DoxyCompactList}\small\item\em Read one byte from T\+WI slave device and acknowledge it by A\+CK. \end{DoxyCompactList}\item 
uint8\+\_\+t \hyperlink{a00014_gaa21e972557bab9a799720874660cf152}{twi\+\_\+read\+\_\+nack} (void)
\begin{DoxyCompactList}\small\item\em Read one byte from T\+WI slave device and acknowledge it by N\+A\+CK. \end{DoxyCompactList}\item 
void \hyperlink{a00014_gacf52d6c93df110dee6d402b389e5042e}{twi\+\_\+stop} (void)
\begin{DoxyCompactList}\small\item\em Generates stop condition on T\+WI bus. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsubsection{Detailed Description}
T\+WI library for A\+V\+R-\/\+G\+CC. 


\begin{DoxyCode}
\textcolor{preprocessor}{#include "\hyperlink{a00007}{twi.h}"} 
\end{DoxyCode}


This library defines functions for the T\+WI (I2C) communication between A\+VR and slave device(s). Functions use internal T\+WI module of A\+VR.

\begin{DoxyNote}{Note}
Based on Microchip Atmel A\+Tmega16 and A\+Tmega328P manuals. 
\end{DoxyNote}
\begin{DoxyAuthor}{Author}
Tomas Fryza, Dept. of Radio Electronics, Brno University of Technology, Czechia 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
(c) 2018-\/2021 Tomas Fryza, This work is licensed under the terms of the M\+IT license 
\end{DoxyCopyright}


\subsubsection{Function Documentation}
\index{T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}!twi\+\_\+init@{twi\+\_\+init}}
\index{twi\+\_\+init@{twi\+\_\+init}!T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}}
\paragraph[{\texorpdfstring{twi\+\_\+init(void)}{twi_init(void)}}]{\setlength{\rightskip}{0pt plus 5cm}void twi\+\_\+init (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{a00014_ga16f0e6b2fa5a26eadbf4086ab6d54467}{}\label{a00014_ga16f0e6b2fa5a26eadbf4086ab6d54467}


Initialize T\+WI, enable internal pull-\/ups, set S\+CL frequency. 

\begin{DoxyParagraph}{Implementation notes\+:}

\begin{DoxyItemize}
\item A\+VR internal pull-\/up resistors at pins T\+W\+I\+\_\+\+S\+D\+A\+\_\+\+P\+IN and T\+W\+I\+\_\+\+S\+C\+L\+\_\+\+P\+IN are enabled
\item T\+WI bit rate register value is calculated as follows fscl = fcpu/(16 + 2$\ast$\+T\+W\+BR) 
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\index{T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}!twi\+\_\+read\+\_\+ack@{twi\+\_\+read\+\_\+ack}}
\index{twi\+\_\+read\+\_\+ack@{twi\+\_\+read\+\_\+ack}!T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}}
\paragraph[{\texorpdfstring{twi\+\_\+read\+\_\+ack(void)}{twi_read_ack(void)}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t twi\+\_\+read\+\_\+ack (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{a00014_ga7a2cd23dea30ee2c99c1ccffb3402d79}{}\label{a00014_ga7a2cd23dea30ee2c99c1ccffb3402d79}


Read one byte from T\+WI slave device and acknowledge it by A\+CK. 

\begin{DoxyReturn}{Returns}
Received data byte 
\end{DoxyReturn}
\index{T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}!twi\+\_\+read\+\_\+nack@{twi\+\_\+read\+\_\+nack}}
\index{twi\+\_\+read\+\_\+nack@{twi\+\_\+read\+\_\+nack}!T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}}
\paragraph[{\texorpdfstring{twi\+\_\+read\+\_\+nack(void)}{twi_read_nack(void)}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t twi\+\_\+read\+\_\+nack (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{a00014_gaa21e972557bab9a799720874660cf152}{}\label{a00014_gaa21e972557bab9a799720874660cf152}


Read one byte from T\+WI slave device and acknowledge it by N\+A\+CK. 

\begin{DoxyReturn}{Returns}
Received data byte 
\end{DoxyReturn}
\index{T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}!twi\+\_\+start@{twi\+\_\+start}}
\index{twi\+\_\+start@{twi\+\_\+start}!T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}}
\paragraph[{\texorpdfstring{twi\+\_\+start(uint8\+\_\+t slave\+\_\+address)}{twi_start(uint8_t slave_address)}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t twi\+\_\+start (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{slave\+\_\+address}
\end{DoxyParamCaption}
)}\hypertarget{a00014_ga36b3c950a1804f75057a870afdf81d55}{}\label{a00014_ga36b3c950a1804f75057a870afdf81d55}


Start communication on T\+WI bus and send address of T\+WI slave. 


\begin{DoxyParams}{Parameters}
{\em slave\+\_\+address} & S\+L\+A+R or S\+L\+A+W address \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & -\/ Slave device accessible \\
\hline
{\em 1} & -\/ Failed to access slave device \\
\hline
\end{DoxyRetVals}
\begin{DoxyNote}{Note}
Function returns 0 only if 0x18 or 0x40 status code is detected~\newline
 0x18\+: S\+L\+A+W has been transmitted and A\+CK has been received~\newline
 0x40\+: S\+L\+A+R has been transmitted and A\+CK has been received~\newline

\end{DoxyNote}
\index{T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}!twi\+\_\+stop@{twi\+\_\+stop}}
\index{twi\+\_\+stop@{twi\+\_\+stop}!T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}}
\paragraph[{\texorpdfstring{twi\+\_\+stop(void)}{twi_stop(void)}}]{\setlength{\rightskip}{0pt plus 5cm}void twi\+\_\+stop (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{a00014_gacf52d6c93df110dee6d402b389e5042e}{}\label{a00014_gacf52d6c93df110dee6d402b389e5042e}


Generates stop condition on T\+WI bus. 

\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\index{T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}!twi\+\_\+write@{twi\+\_\+write}}
\index{twi\+\_\+write@{twi\+\_\+write}!T\+W\+I Library $<$twi.\+h$>$@{T\+W\+I Library $<$twi.\+h$>$}}
\paragraph[{\texorpdfstring{twi\+\_\+write(uint8\+\_\+t data)}{twi_write(uint8_t data)}}]{\setlength{\rightskip}{0pt plus 5cm}void twi\+\_\+write (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{data}
\end{DoxyParamCaption}
)}\hypertarget{a00014_gab45679e1a7b3b8f97b636d825e7d14f7}{}\label{a00014_gab45679e1a7b3b8f97b636d825e7d14f7}


Send one data byte to T\+WI slave device. 


\begin{DoxyParams}{Parameters}
{\em data} & Byte to be transmitted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
